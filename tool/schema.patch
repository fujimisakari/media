# ------- 10/01に追加分 -------
# カラム型変更
ALTER TABLE book_entry_detail ALTER COLUMN create_date TYPE date;
ALTER TABLE book_entry_detail ALTER COLUMN epud_size TYPE integer null;

# not nullの解除
# ALTER TABLE book_entry_detail ALTER COLUMN pdf_size DROP NOT NULL;
# ALTER TABLE book_entry_detail ALTER COLUMN epud_size DROP NOT NULL;
# ALTER TABLE book_entry_detail ALTER COLUMN description DROP NOT NULL;
# ALTER TABLE book_entry_detail ALTER COLUMN total_page DROP NOT NULL;

# カラム追加
ALTER TABLE book_category ADD sort integer null;
ALTER TABLE book_subcategory ADD sort integer null;


# ------- 10/30に追加分 -------

# カラム追加
ALTER TABLE book_writer ADD category_id INTEGER;
ALTER TABLE book_entry_detail ADD exit_attachment BOOLEAN;

# 既存カラムのデフォルト値を変更(デフォルト値削除は ALTER TABLE products ALTER COLUMN price DROP DEFAULT;)
# ALTER TABLE book_entry_detail ALTER COLUMN pdf_size SET DEFAULT 0;
# ALTER TABLE book_entry_detail ALTER COLUMN epud_size SET DEFAULT 0;
# ALTER TABLE book_entry_detail ALTER COLUMN total_page SET DEFAULT 0;


# NOT NULL設定はその列にNULLが一つもない場合できるので、一旦該当列のすべてに値をセットする
ALTER TABLE book_entry_detail ALTER COLUMN exit_attachment SET NOT NULL;
ALTER TABLE book_writer ALTER COLUMN category_id SET NOT NULL;

# 外部キー設定
# ...
# CONSTRAINT 制約名
# FOREIGN KEY (外部キー名)
# REFERENCES 参照先テーブル名(参照先列名)
# DEFERRABLE INITIALLY DEFERRED(またはMATCH FULL)
#
# (トランザクションにおける制約の検査方法を設定)
# DEFERRABLE INITIALLY IMMEDIATE(1つの文の実行が終るごとに検査)
# DEFERRABLE INITIALLY DEFERRED(コミット後に検査)
# ...
#(解除は ALTER TABLE book_writer DROP CONSTRAINT "book_writer_category_id_fkey" )
ALTER TABLE book_writer ADD CONSTRAINT "book_writer_category_id_fkey" FOREIGN KEY (category_id) REFERENCES book_category(id) DEFERRABLE INITIALLY DEFERRED
